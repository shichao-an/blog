<?xml version="1.0" encoding="utf-8"?>
<rss version="2.0">
    <channel>
        <title>Shichao's Blog</title>
        <link>http://blog.shichao-an.info/blog/html/</link>
        <description>Recording molecular stuff</description>
        <language>en-us</language>
        <pubDate>Mon, 17 Mar 2014 00:00:00 -0400</pubDate>
        
        <item>
            <link>http://blog.shichao-an.info/blog/html/2014/03/17/setuid_and_uid_euid_and_suid.html</link>
            <guid>http://blog.shichao-an.info/blog/html/2014/03/17/setuid_and_uid_euid_and_suid.html</guid>
            <title><![CDATA[setuid() and uid, euid and suid]]></title>
            <description><![CDATA[<div class="section" id="setuid-and-uid-euid-and-suid">
<h1>setuid() and uid, euid and suid</h1>
<p>We know that <cite>setuid</cite> bit allows the program to change its effective uid (euid) upon execution. I want to take a look at how <cite>setuid()</cite> system call works through this experiment.</p>
<p>Open a terminal session and run the <span class="docutils literal"><span class="pre">passwd</span></span> command (a known <cite>setuid</cite> executable) in the background (it will be suspended with a “[stopped]” output because it requires password from stdin) and get its PID (let’s assume it’s 10401) with <span class="docutils literal"><span class="pre">echo</span> <span class="pre">$!</span></span>:</p>
<div class="highlight-python"><div class="highlight"><pre>$ passwd &amp;
$ echo $!  # 10401
</pre></div>
</div>
<p>Then, run <span class="docutils literal"><span class="pre">gdb</span></span> to attach to this process:</p>
<div class="highlight-python"><div class="highlight"><pre>$ sudo gdb -p $!
</pre></div>
</div>
<p>Open another terminal, the run the following command to get the line that represents the current real UID (<cite>uid</cite>), effective UID (<cite>euid</cite>), saved UID (<cite>suid</cite>) and file system UID (<cite>fsuid</cite>) of the previous <span class="docutils literal"><span class="pre">passwd</span></span> process:</p>
<div class="highlight-python"><div class="highlight"><pre>$ watch -n 1 grep -i 'uid' /proc/10401/task/10401/status
Uid:    1000    0       0   0
</pre></div>
</div>
<p>In the first terminal, you can call <cite>seteuid(1000)</cite> to change its <cite>euid</cite> to 1000:</p>
<div class="highlight-python"><div class="highlight"><pre>(gdb) call seteuid(1000)
$1 = 0
</pre></div>
</div>
<p>Then the output of the <span class="docutils literal"><span class="pre">watch</span></span> command will become:</p>
<div class="highlight-python"><div class="highlight"><pre>Uid:    1000    1000    0   1000
</pre></div>
</div>
<p>The <cite>euid</cite> is 1000 and the process becomes unprivileged, and you can see the USER field has been changed to the regular user instead of root:</p>
<div class="highlight-python"><div class="highlight"><pre>$ ps -u -p 10401
</pre></div>
</div>
<p>At this time, you can only change its effective UID to either that of the real UID or the saved UID (1000 or 0). You can also use <cite>setresuid(u,e,s)</cite> to change them at the same time.</p>
<p>To revert the <cite>euid</cite> back to 0, you can use either <cite>setuid(0)</cite> or <cite>seteuid(0)</cite>. This is because when <cite>euid</cite> is not 0, the <cite>setuid(e)</cite> system call only modifies <cite>euid</cite> and <cite>fsuid</cite> to <cite>e</cite> leaving the other two unchanged:</p>
<div class="highlight-python"><div class="highlight"><pre>(gdb) call setuid(0)
$2 = 0
</pre></div>
</div>
<p>At this time, when <cite>euid</cite> is 0, if you call <cite>setuid(1000)</cite> it will sets all the four fields to 1000 and the process will be permanently unprivileged.</p>
<div class="highlight-python"><div class="highlight"><pre>(gdb) call setuid(1000)
$3 = 0
(gdb) call setuid(0)
$4 = -1
(gdb) detach
Detaching from program: /usr/bin/passwd, process 10401
(gdb) quit
</pre></div>
</div>
</div>]]></description>
             <pubDate>Mon, 17 Mar 2014 00:00:00 -0400</pubDate>
        </item>
    
        <item>
            <link>http://blog.shichao-an.info/blog/html/2014/03/05/suppressing_fedora.html</link>
            <guid>http://blog.shichao-an.info/blog/html/2014/03/05/suppressing_fedora.html</guid>
            <title><![CDATA[Suppressing Fedora NetworkManager's prompt to connect to WPA Enterprise wireless networks]]></title>
            <description><![CDATA[<div class="section" id="suppressing-fedora-networkmanager-s-prompt-to-connect-to-wpa-enterprise-wireless-networks">
<h1>Suppressing Fedora NetworkManager’s prompt to connect to WPA Enterprise wireless networks</h1>
<p>This seems to be an unsolved bug (<a class="reference external" href="https://bugzilla.redhat.com/show_bug.cgi?id=982429">#982429</a>) still under discussion. Many give temporary solutions that modify the corresponding <span class="docutils literal"><span class="pre">ifcfg-*</span></span> file and specify the password, possibly in plaintext form. Some suggest encrypting the password using <span class="docutils literal"><span class="pre">wpa_passphrase</span> <span class="pre">ESSID</span></span> command. The problematic network here is “nyu” of the New York University. Every time I turned on my laptop on the campus, it prompts with a dialog (though the password is actually stored) for me to click the “Connect” button, which is annoying. However, the encryption method does not work as far as I am concerned with Fedora 20. So I just followed the plaintext way to produce a temporary fix for that:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="c"># cd /etc/sysconfig/network-scripts</span>
<span class="c"># vim ifcfg-nyu</span>
</pre></div>
</div>
<p>Comment or remove the following line:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">IEEE_8021X_PASSWORD_FLAGS</span><span class="o">=</span><span class="n">user</span>
</pre></div>
</div>
<p>Create a new file named <span class="docutils literal"><span class="pre">keys-nyu</span></span> in this directory with your password:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">IEEE_8021X_PASSWORD</span><span class="o">=</span><span class="s">'your_password'</span>
</pre></div>
</div>
<p>Don’t forget to make it read-writable by root only:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="c"># chmod 600 keys-nyu</span>
</pre></div>
</div>
<p>Then restart your network interface associated with “nyu”:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="c"># ifdown nyu</span>
<span class="c"># ifup nyu</span>
</pre></div>
</div>
<p>Then, the wireless network should work as expected. Try to logout or reboot to see if it surely works.</p>
</div>]]></description>
             <pubDate>Wed, 05 Mar 2014 00:00:00 -0500</pubDate>
        </item>
    
    </channel>
</rss>